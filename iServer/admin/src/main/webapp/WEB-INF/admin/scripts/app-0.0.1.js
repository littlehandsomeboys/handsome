!function t(e,n,i){function o(r,s){if(!n[r]){if(!e[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(a)return a(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var p=n[r]={exports:{}};e[r][0].call(p.exports,function(t){var n=e[r][1][t];return o(n?n:t)},p,p.exports,t,e,n,i)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}({1:[function(t,e){e.exports={domain:"g.alicdn.com",flashVersion:"1.1.1"}},{}],2:[function(t,e,n){var i=t("./player/player"),o=t("./player/flashplayer"),a=t("./lib/dom"),r=t("./lib/ua"),s=t("./lib/object"),l=t("./config"),c=function(t){var e,n=t.id;if("string"==typeof n){if(0===n.indexOf("#")&&(n=n.slice(1)),c.players[n])return c.players[n];e=a.el(n)}else e=n;if(!e||!e.nodeName)throw new TypeError("没有为播放器指定容器");var l=s.merge(s.copy(c.defaultOpt),t);return l.width&&(e.style.width=l.width),l.height&&(e.style.height=l.height),e.player||(r.IS_MOBILE?new i(e,l):new o(e,l))},p=window.prismplayer=c;c.players={},c.defaultOpt={preload:!1,autoplay:!0,useNativeControls:!1,width:"100%",height:"300px",cover:"",from:"de_player",trackLog:!0,swfWaterMark:"",isLive:!1,skinRes:"//"+l.domain+"/de/prismplayer-flash/"+l.flashVersion+"/atlas/defaultSkin",skinLayout:[{name:"bigPlayButton",align:"blabs",x:30,y:80},{name:"controlBar",align:"blabs",x:0,y:0,children:[{name:"progress",align:"tlabs",x:0,y:0},{name:"playButton",align:"tl",x:15,y:26},{name:"nextButton",align:"tl",x:10,y:26},{name:"timeDisplay",align:"tl",x:10,y:24},{name:"fullScreenButton",align:"tr",x:20,y:25},{name:"setButton",align:"tr",x:20,y:25},{name:"streamButton",align:"tr",x:20,y:23},{name:"volume",align:"tr",x:20,y:25}]},{name:"fullControlBar",align:"tlabs",x:0,y:0,children:[{name:"fullTitle",align:"tl",x:25,y:6},{name:"fullNormalScreenButton",align:"tr",x:24,y:13},{name:"fullTimeDisplay",align:"tr",x:10,y:12},{name:"fullZoom",align:"cc"}]}]},"function"==typeof define&&define.amd?define([],function(){return p}):"object"==typeof n&&"object"==typeof e&&(e.exports=p)},{"./config":1,"./lib/dom":5,"./lib/object":10,"./lib/ua":12,"./player/flashplayer":16,"./player/player":17}],3:[function(t,e){e.exports.get=function(t){for(var e=t+"",n=document.cookie.split(";"),i=0;i<n.length;i++){var o=n[i].trim();if(0==o.indexOf(e))return unescape(o.substring(e.length+1,o.length))}return""},e.exports.set=function(t,e,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var o="expires="+i.toGMTString();document.cookie=t+"="+escape(e)+"; "+o}},{}],4:[function(t,e){var n=t("./object");e.exports.cache={},e.exports.guid=function(t,e){var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(e=e||i.length,t)for(n=0;t>n;n++)o[n]=i[0|Math.random()*e];else{var a;for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;36>n;n++)o[n]||(a=0|16*Math.random(),o[n]=i[19==n?3&a|8:a])}return o.join("")},e.exports.expando="vdata"+(new Date).getTime(),e.exports.getData=function(t){var n=t[e.exports.expando];return n||(n=t[e.exports.expando]=e.exports.guid(),e.exports.cache[n]={}),e.exports.cache[n]},e.exports.hasData=function(t){var i=t[e.exports.expando];return!(!i||n.isEmpty(e.exports.cache[i]))},e.exports.removeData=function(t){var n=t[e.exports.expando];if(n){delete e.exports.cache[n];try{delete t[e.exports.expando]}catch(i){t.removeAttribute?t.removeAttribute(e.exports.expando):t[e.exports.expando]=null}}}},{"./object":10}],5:[function(t,e){var n=t("./object");e.exports.el=function(t){return document.getElementById(t)},e.exports.createEl=function(t,e){var i;return t=t||"div",e=e||{},i=document.createElement(t),n.each(e,function(t,e){-1!==t.indexOf("aria-")||"role"==t?i.setAttribute(t,e):i[t]=e}),i},e.exports.addClass=function(t,e){-1==(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className=""===t.className?e:t.className+" "+e)},e.exports.removeClass=function(t,e){var n,i;if(-1!=t.className.indexOf(e)){for(n=t.className.split(" "),i=n.length-1;i>=0;i--)n[i]===e&&n.splice(i,1);t.className=n.join(" ")}},e.exports.getElementAttributes=function(t){var e,n,i,o,a;if(e={},n=",autoplay,controls,loop,muted,default,",t&&t.attributes&&t.attributes.length>0){i=t.attributes;for(var r=i.length-1;r>=0;r--)o=i[r].name,a=i[r].value,("boolean"==typeof t[o]||-1!==n.indexOf(","+o+","))&&(a=null!==a?!0:!1),e[o]=a}return e},e.exports.insertFirst=function(t,e){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},e.exports.blockTextSelection=function(){document.body.focus(),document.onselectstart=function(){return!1}},e.exports.unblockTextSelection=function(){document.onselectstart=function(){return!0}},e.exports.css=function(t,e,i){return t.style?e&&i?(t.style[e]=i,!0):i||"string"!=typeof e?i||"object"!=typeof e?!1:(n.each(e,function(e,n){t.style[e]=n}),!0):t.style[e]:!1}},{"./object":10}],6:[function(t,e){function n(t,e,n,o){i.each(n,function(n){t(e,n,o)})}var i=t("./object"),o=t("./data");e.exports.on=function(t,a,r){if(i.isArray(a))return n(e.exports.on,t,a,r);var s=o.getData(t);s.handlers||(s.handlers={}),s.handlers[a]||(s.handlers[a]=[]),r.guid||(r.guid=o.guid()),s.handlers[a].push(r),s.dispatcher||(s.disabled=!1,s.dispatcher=function(n){if(!s.disabled){n=e.exports.fixEvent(n);var i=s.handlers[n.type];if(i)for(var o=i.slice(0),a=0,r=o.length;r>a&&!n.isImmediatePropagationStopped();a++)o[a].call(t,n)}}),1==s.handlers[a].length&&(t.addEventListener?t.addEventListener(a,s.dispatcher,!1):t.attachEvent&&t.attachEvent("on"+a,s.dispatcher))},e.exports.off=function(t,a,r){if(o.hasData(t)){var s=o.getData(t);if(s.handlers){if(i.isArray(a))return n(e.exports.off,t,a,r);var l=function(n){s.handlers[n]=[],e.exports.cleanUpEvents(t,n)};if(a){var c=s.handlers[a];if(c){if(!r)return void l(a);if(r.guid)for(var p=0;p<c.length;p++)c[p].guid===r.guid&&c.splice(p--,1);e.exports.cleanUpEvents(t,a)}}else for(var d in s.handlers)l(d)}}},e.exports.cleanUpEvents=function(t,e){var n=o.getData(t);0===n.handlers[e].length&&(delete n.handlers[e],t.removeEventListener?t.removeEventListener(e,n.dispatcher,!1):t.detachEvent&&t.detachEvent("on"+e,n.dispatcher)),i.isEmpty(n.handlers)&&(delete n.handlers,delete n.dispatcher,delete n.disabled),i.isEmpty(n)&&o.removeData(t)},e.exports.fixEvent=function(t){function e(){return!0}function n(){return!1}if(!t||!t.isPropagationStopped){var i=t||window.event;t={};for(var o in i)"layerX"!==o&&"layerY"!==o&&"keyboardEvent.keyLocation"!==o&&("returnValue"==o&&i.preventDefault||(t[o]=i[o]));if(t.target||(t.target=t.srcElement||document),t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement,t.preventDefault=function(){i.preventDefault&&i.preventDefault(),t.returnValue=!1,t.isDefaultPrevented=e,t.defaultPrevented=!0},t.isDefaultPrevented=n,t.defaultPrevented=!1,t.stopPropagation=function(){i.stopPropagation&&i.stopPropagation(),t.cancelBubble=!0,t.isPropagationStopped=e},t.isPropagationStopped=n,t.stopImmediatePropagation=function(){i.stopImmediatePropagation&&i.stopImmediatePropagation(),t.isImmediatePropagationStopped=e,t.stopPropagation()},t.isImmediatePropagationStopped=n,null!=t.clientX){var a=document.documentElement,r=document.body;t.pageX=t.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0),t.pageY=t.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)}t.which=t.charCode||t.keyCode,null!=t.button&&(t.button=1&t.button?0:4&t.button?1:2&t.button?2:0)}return t},e.exports.trigger=function(t,n){var i=o.hasData(t)?o.getData(t):{},a=t.parentNode||t.ownerDocument;if("string"==typeof n){var r=null;t.paramData&&(r=t.paramData,t.paramData=null,t.removeAttribute(r)),n={type:n,target:t,paramData:r}}if(n=e.exports.fixEvent(n),i.dispatcher&&i.dispatcher.call(t,n),a&&!n.isPropagationStopped()&&n.bubbles!==!1)e.exports.trigger(a,n);else if(!a&&!n.defaultPrevented){var s=o.getData(n.target);n.target[n.type]&&(s.disabled=!0,"function"==typeof n.target[n.type]&&n.target[n.type](),s.disabled=!1)}return!n.defaultPrevented},e.exports.one=function(t,a,r){if(i.isArray(a))return n(e.exports.one,t,a,r);var s=function(){e.exports.off(t,a,s),r.apply(this,arguments)};s.guid=r.guid=r.guid||o.guid(),e.exports.on(t,a,s)}},{"./data":4,"./object":10}],7:[function(t,e){var n=t("./data");e.exports.bind=function(t,e,i){e.guid||(e.guid=n.guid());var o=function(){return e.apply(t,arguments)};return o.guid=i?i+"_"+e.guid:e.guid,o}},{"./data":4}],8:[function(t,e){var n=t("./url");e.exports.get=function(t,e,i,o){var a,r,s,l,c;i=i||function(){},"undefined"==typeof XMLHttpRequest&&(window.XMLHttpRequest=function(){try{return new window.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new window.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new window.ActiveXObject("Msxml2.XMLHTTP")}catch(n){}throw new Error("This browser does not support XMLHttpRequest.")}),r=new XMLHttpRequest,s=n.parseUrl(t),l=window.location,c=s.protocol+s.host!==l.protocol+l.host,!c||!window.XDomainRequest||"withCredentials"in r?(a="file:"==s.protocol||"file:"==l.protocol,r.onreadystatechange=function(){4===r.readyState&&(200===r.status||a&&0===r.status?e(r.responseText):i(r.responseText))}):(r=new window.XDomainRequest,r.onload=function(){e(r.responseText)},r.onerror=i,r.onprogress=function(){},r.ontimeout=i);try{r.open("GET",t,!0),o&&(r.withCredentials=!0)}catch(p){return void i(p)}try{r.send()}catch(p){i(p)}},e.exports.jsonp=function(t,e,n){var i="jsonp_callback_"+Math.round(1e5*Math.random()),o=document.createElement("script");o.src=t+(t.indexOf("?")>=0?"&":"?")+"callback="+i,o.onerror=function(){delete window[i],document.body.removeChild(o),n()},o.onload=function(){setTimeout(function(){window[i]&&(delete window[i],document.body.removeChild(o))},0)},window[i]=function(t){delete window[i],document.body.removeChild(o),e(t)},document.body.appendChild(o)}},{"./url":13}],9:[function(t,e){var n=t("./dom");e.exports.render=function(t,e){var i=e.align?e.align:"tl",o=e.x?e.x:0,a=e.y?e.y:0;"tl"===i?n.css(t,{"float":"left","margin-left":o+"px","margin-top":a+"px"}):"tr"===i?n.css(t,{"float":"right","margin-right":o+"px","margin-top":a+"px"}):"tlabs"===i?n.css(t,{position:"absolute",left:o+"px",top:a+"px"}):"trabs"===i?n.css(t,{position:"absolute",right:o+"px",top:a+"px"}):"blabs"===i?n.css(t,{position:"absolute",left:o+"px",bottom:a+"px"}):"brabs"===i?n.css(t,{position:"absolute",right:o+"px",bottom:a+"px"}):"cc"===i&&n.css(t,{position:"absolute",left:"50%",top:"50%","margin-top":t.offsetHeight/-2+"px","margin-left":t.offsetWidth/-2+"px"})}},{"./dom":5}],10:[function(t,e){var n=Object.prototype.hasOwnProperty;e.exports.create=Object.create||function(t){function e(){}return e.prototype=t,new e},e.exports.isArray=function(){return"[object Array]"===Object.prototype.toString.call(arg)},e.exports.isEmpty=function(t){for(var e in t)if(null!==t[e])return!1;return!0},e.exports.each=function(t,i,o){if(e.exports.isArray(t))for(var a=0,r=t.length;r>a&&i.call(o||this,t[a],a)!==!1;++a);else for(var s in t)if(n.call(t,s)&&i.call(o||this,s,t[s])===!1)break;return t},e.exports.merge=function(t,e){if(!e)return t;for(var i in e)n.call(e,i)&&(t[i]=e[i]);return t},e.exports.deepMerge=function(t,i){var o,a,r;t=e.exports.copy(t);for(o in i)n.call(i,o)&&(a=t[o],r=i[o],t[o]=e.exports.isPlain(a)&&e.exports.isPlain(r)?e.exports.deepMerge(a,r):i[o]);return t},e.exports.copy=function(t){return e.exports.merge({},t)},e.exports.isPlain=function(t){return!!t&&"object"==typeof t&&"[object Object]"===t.toString()&&t.constructor===Object},e.exports.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},e.exports.unescape=function(t){return t.replace(/&([^;]+);/g,function(t,e){return{amp:"&",lt:"<",gt:">",quot:'"',"#x27":"'","#x60":"`"}[e.toLowerCase()]||t})}},{}],11:[function(t,e){var n=t("./object"),i=function(){},i=function(){};i.extend=function(t){var e,o;t=t||{},e=t.init||t.init||this.prototype.init||this.prototype.init||function(){},o=function(){e.apply(this,arguments)},o.prototype=n.create(this.prototype),o.prototype.constructor=o,o.extend=i.extend,o.create=i.create;for(var a in t)t.hasOwnProperty(a)&&(o.prototype[a]=t[a]);return o},i.create=function(){var t=n.create(this.prototype);return this.apply(t,arguments),t},e.exports=i},{"./object":10}],12:[function(t,e){e.exports.USER_AGENT=navigator.userAgent,e.exports.IS_IPHONE=/iPhone/i.test(e.exports.USER_AGENT),e.exports.IS_IPAD=/iPad/i.test(e.exports.USER_AGENT),e.exports.IS_IPOD=/iPod/i.test(e.exports.USER_AGENT),e.exports.IS_IOS=e.exports.IS_IPHONE||e.exports.IS_IPAD||e.exports.IS_IPOD,e.exports.IOS_VERSION=function(){var t=e.exports.USER_AGENT.match(/OS (\d+)_/i);return t&&t[1]?t[1]:void 0}(),e.exports.IS_ANDROID=/Android/i.test(e.exports.USER_AGENT),e.exports.ANDROID_VERSION=function(){var t,n,i=e.exports.USER_AGENT.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);return i?(t=i[1]&&parseFloat(i[1]),n=i[2]&&parseFloat(i[2]),t&&n?parseFloat(i[1]+"."+i[2]):t?t:null):null}(),e.exports.IS_OLD_ANDROID=e.exports.IS_ANDROID&&/webkit/i.test(e.exports.USER_AGENT)&&e.exports.ANDROID_VERSION<2.3,e.exports.IS_FIREFOX=/Firefox/i.test(e.exports.USER_AGENT),e.exports.IS_CHROME=/Chrome/i.test(e.exports.USER_AGENT),e.exports.TOUCH_ENABLED=!!("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),e.exports.IS_MOBILE=e.exports.IS_IOS||e.exports.IS_ANDROID,e.exports.IS_PC=!e.exports.IS_MOBILE},{}],13:[function(t,e){var n=t("./dom");e.exports.getAbsoluteURL=function(t){return t.match(/^https?:\/\//)||(t=n.createEl("div",{innerHTML:'<a href="'+t+'">x</a>'}).firstChild.href),t},e.exports.parseUrl=function(t){var e,i,o,a,r;a=["protocol","hostname","port","pathname","search","hash","host"],i=n.createEl("a",{href:t}),o=""===i.host&&"file:"!==i.protocol,o&&(e=n.createEl("div"),e.innerHTML='<a href="'+t+'"></a>',i=e.firstChild,e.setAttribute("style","display:none; position:absolute;"),document.body.appendChild(e)),r={};for(var s=0;s<a.length;s++)r[a[s]]=i[a[s]];return o&&document.body.removeChild(e),r}},{"./dom":5}],14:[function(t,e){e.exports.formatTime=function(t){var e,n,i,o=Math.round(t);return e=Math.floor(o/3600),o%=3600,n=Math.floor(o/60),i=o%60,e===1/0||isNaN(e)||n===1/0||isNaN(n)||i===1/0||isNaN(i)?!1:(e=e>=10?e:"0"+e,n=n>=10?n:"0"+n,i=i>=10?i:"0"+i,("00"===e?"":e+":")+n+":"+i)},e.exports.parseTime=function(t){var e=t.split(":"),n=0,i=0,o=0;return 3===e.length?(n=e[0],i=e[1],o=e[2]):2===e.length?(i=e[0],o=e[1]):1===e.length&&(o=e[0]),n=parseInt(n,10),i=parseInt(i,10),o=Math.ceil(parseFloat(o)),3600*n+60*i+o}},{}],15:[function(t,e){var n,i=t("../lib/oo"),o=t("../lib/object"),a=t("../lib/cookie"),r=t("../lib/data"),s=t("../lib/io"),l=t("../lib/ua"),c={INIT:1001,CLOSE:1002,PLAY:2001,STOP:2002,PAUSE:2003,RECOVER:2010,SEEK:2004,SEEK_END:2011,UNDERLOAD:3002,LOADED:3001,RESOLUTION:2007,RESOLUTION_DONE:2009,HEARTBEAT:9001,ERROR:4001},p=i.extend({init:function(t,e){if(this.player=t,e.from){var n=e.from.split("_"),i=n[0]?n[0]:null,a=n[1]?n[1]:null;i&&a&&(e.device_model=i,e.act_name=a)}var r=1;l.IS_IPAD?r=128:l.IS_IPHONE?r=256:l.IS_ANDROID&&(r=512),this.opt=o.merge({log_version:1,use_type:"prism",device_model:"de",act_name:"player",player_version:1,uuid:this._getUuid(),video_id:0,album_id:0,category_id:0,bitrate:"LD_H264",cdn:"0.0.0.0",ldns:"0.0.0.0",platform:r,download_speed:100},e),this.bindEvent()},updateVideoInfo:function(t){if(t.from){var e=t.from.split("_"),n=e[0]?e[0]:null,i=e[1]?e[1]:null;n&&i&&(t.device_model=n,t.act_name=i)}var a=1;l.IS_IPAD?a=128:l.IS_IPHONE?a=256:l.IS_ANDROID&&(a=512),this.opt=o.merge({log_version:1,use_type:"prism",device_model:"de",act_name:"player",player_version:1,uuid:this._getUuid(),video_id:0,album_id:0,category_id:0,bitrate:"LD_H264",cdn:"0.0.0.0",ldns:"0.0.0.0",platform:a,download_speed:100},t)},bindEvent:function(){var t=this;this.player.on("init",function(){t._onPlayerInit()}),window.addEventListener("beforeunload",function(){t._onPlayerClose()}),this.player.on("ready",function(){t._onPlayerReady()}),this.player.on("ended",function(){t._onPlayerFinish()}),this.player.on("play",function(){t._onPlayerPlay()}),this.player.on("pause",function(){t._onPlayerPause()}),this.player.on("seekStart",function(e){t._onPlayerSeekStart(e)}),this.player.on("seekEnd",function(e){t._onPlayerSeekEnd(e)}),this.player.on("canplaythrough",function(){t._onPlayerLoaded()}),this.player.on("error",function(){t._onPlayerError()}),n=setInterval(function(){2===t.player.readyState()||3===t.player.readyState()?t._onPlayerLoaded():4===t.player.readyState()&&t._onPlayerUnderload()},100)},removeEvent:function(){this.player.off("init"),this.player.off("ready"),this.player.off("ended"),this.player.off("play"),this.player.off("pause"),this.player.off("seekStart"),this.player.off("seekEnd"),this.player.off("canplaythrough"),this.player.off("error"),clearInterval(n)},_onPlayerInit:function(){this.sessionId=r.guid(),this._log("INIT",{})},_onPlayerClose:function(){this._log("CLOSE",{vt:1e3*this.player.getCurrentTime()})},_onPlayerReady:function(){this._log("PLAY",{play_mode:"fix",vt:0,cost:this.player.getReadyTime()})},_onPlayerFinish:function(){this.sessionId=r.guid(),this._log("STOP",{vt:1e3*this.player.getCurrentTime()})},_onPlayerPlay:function(){this._log("RECOVER",{vt:1e3*this.player.getCurrentTime()})},_onPlayerPause:function(){this._log("PAUSE",{vt:1e3*this.player.getCurrentTime()})},_onPlayerSeekStart:function(t){this.seekStartTime=t.paramData.fromTime,this.seeking=!0},_onPlayerSeekEnd:function(t){this._log("SEEK",{drag_from_timestamp:1e3*this.seekStartTime,drag_to_timestamp:1e3*t.paramData.toTime}),this.seeking=!1},_onPlayerLoaded:function(){this.stucking||this.seeking||(this.stucking=!0,this._log("UNDERLOAD",{vt:1e3*this.player.getCurrentTime()}),this.stuckStartTime=(new Date).getTime())},_onPlayerUnderload:function(){if(this.stucking&&!this.seeking){var t=Math.floor(1e3*this.player.getCurrentTime()),e=this.stuckStartTime||(new Date).getTime(),n=Math.floor((new Date).getTime()-e);0>n&&(n=0),this._log("LOADED",{vt:t,cost:n}),this.stucking=!1}},_onPlayerHeartBeat:function(){if(!this.seeking){var t=Math.floor(1e3*this.player.getCurrentTime()),e=this;this.timer||(this.timer=setTimeout(function(){!e.seeking&&e._log("HEARTBEAT",{progress:t}),clearTimeout(e.timer),e.timer=null},5e3))}},_onPlayerError:function(){var t,e={MEDIA_ERR_NETWORK:-1,MEDIA_ERR_SRC_NOT_SUPPORTED:-2,MEDIA_ERR_DECODE:-3},n=this.player.getError(),i=n.code;o.each(n.__proto__,function(e,n){return n===i?(t=e,!1):void 0}),e[t]&&this._log("ERROR",{vt:1e3*this.player.getCurrentTime(),error_code:e[t],error_msg:t})},_log:function(t,e){var n=o.copy(this.opt),i="//log.video.taobao.com/stat/";e.vt&&(e.vt=Math.round(e.vt)),e.cost&&(e.cost=Math.round(e.cost)),e.systs=(new Date).getTime(),n.session_id=this.sessionId,n.event_id=c[t],n=o.merge(n,e);var a=[];o.each(n,function(t,e){a.push(t+"="+e)}),a=a.join("&"),s.jsonp(i+"?"+a,function(){},function(){})},_getUuid:function(){var t=a.get("p_h5_u");return t||(t=r.guid(),a.set("p_h5_u",t,7)),t}});e.exports=p},{"../lib/cookie":3,"../lib/data":4,"../lib/io":8,"../lib/object":10,"../lib/oo":11,"../lib/ua":12}],16:[function(t,e){var n=t("../ui/component"),i=t("../lib/data"),o=t("../lib/object"),a=t("../config"),r=n.extend({init:function(t,e){n.call(this,this,e),this._id=this.id="prism-player-"+i.guid(),window[this.id]=this;var o="100%",r="100%",s="//"+a.domain+"/de/prismplayer-flash/"+a.flashVersion+"/PrismPlayer.swf",l=this._comboFlashVars();t.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=5,0,0,0" width="'+o+'" height="'+r+'" id="'+this.id+'"><param name=movie value="'+s+'"><param name=quality value=High><param name="FlashVars" value="'+l+'"><param name="WMode" value="opaque"><param name="AllowScriptAccess" value="always"><param name="AllowFullScreen" value="true"><embed name="'+this.id+'" src="'+s+'" quality=high pluginspage="//www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash" width="'+o+'" height="'+r+'" AllowScriptAccess="always" AllowFullScreen="true" WMode="opaque" FlashVars="'+l+'"></embed></object>'},_getPlayer:function(t){return-1!=navigator.appName.indexOf("Microsoft")?document.getElementById(t):document[t]},_comboFlashVars:function(){var t=this._options,e={autoPlay:t.autoplay?1:0,from:t.from,isInner:0,actRequest:1,vid:t.vid,domain:t.domain?t.domain:"//tv.taobao.com",statisticService:t.statisticService?t.statisticService:"//log.video.taobao.com/stat/",videoInfoService:t.videoInfoService?t.videoInfoService:"/player/json/getBaseVideoInfo.do",disablePing:t.trackLog?0:1,namespace:this.id,barMode:t.barMode,isLive:t.isLive?1:0,waterMark:t.swfWaterMark,vurl:t.source?encodeURIComponent(t.source):""},n=[];return t.cover&&(e.cover=t.cover),o.each(e,function(t,e){n.push(t+"="+e)}),n.join("&")},flashReady:function(){this.flashPlayer=this._getPlayer(this.id),this._isReady=!0;var t,e=this._options.skinRes,n=this._options.skinLayout;if(n!==!1&&!o.isArray(n))throw new Error("PrismPlayer Error: skinLayout should be false or type of array!");if("string"!=typeof e)throw new Error("PrismPlayer Error: skinRes should be string!");t=0==n||0===n.length?!1:{skinRes:e,skinLayout:n},this.flashPlayer.setPlayerSkin(t),this.trigger("ready");var i=this;window.addEventListener("beforeunload",function(){i.flashPlayer.setPlayerCloseStatus()})},jsReady:function(){return!0},onPlay:function(){this.trigger("play")},onEnded:function(){this.trigger("ended")},onPause:function(){this.trigger("pause")},_invoke:function(){var t=arguments[0],e=arguments;if(Array.prototype.shift.call(e),!this.flashPlayer)throw new Error("PrismPlayer Error: flash player is not ready!");if("function"!=typeof this.flashPlayer[t])throw new Error("PrismPlayer Error: function "+t+" is not found!");return this.flashPlayer[t].apply(this.flashPlayer,e)},play:function(){this._invoke("playVideo")},pause:function(){this._invoke("pauseVideo")},seek:function(t){this._invoke("seekVideo",t)},getCurrentTime:function(){return this._invoke("getCurrentTime")},getDuration:function(){return this._invoke("getDuration")},getVolume:function(){return this._invoke("getVolume")},setVolume:function(t){this._invoke("setVolume",t)},loadByVid:function(t){this._invoke("loadByVid",t,!1)},loadByUrl:function(t){this._invoke("loadByUrl",t)},dispose:function(){this._invoke("pauseVideo")}});e.exports=r},{"../config":1,"../lib/data":4,"../lib/object":10,"../ui/component":18}],17:[function(t,e){var n=t("../ui/component"),i=t("../lib/object"),o=t("../lib/dom"),a=t("../lib/event"),r=t("../lib/io"),s=t("../ui/exports"),l=t("../monitor/monitor"),c=t("../lib/ua"),p=n.extend({init:function(t,e){this.tag=t,this.loaded=!1,n.call(this,this,e),e.plugins&&i.each(e.plugins,function(t,e){this[t](e)},this),e.useNativeControls?this.tag.setAttribute("controls","controls"):(this.UI=s,this.initChildren()),this.bindVideoEvent(),this._options.source?(this._options.trackLog&&(this._monitor=new l(this,{video_id:0,album_id:0,from:this._options.from})),this.trigger("init"),this._options.autoplay&&(this.getMetaData(),this.tag.setAttribute("src",this._options.source),this.readyTime=(new Date).getTime(),this.loaded=!0)):this.loadVideoInfo(),this.on("readyState",function(){this.trigger("ready")})}});p.prototype.initChildren=function(){var t=this.options(),e=t.skinLayout;if(e!==!1&&!i.isArray(e))throw new Error("PrismPlayer Error: skinLayout should be false or type of array!");e!==!1&&0!==e.length&&(this.options({children:e}),n.prototype.initChildren.call(this)),this.trigger("uiReady")},p.prototype.createEl=function(){"VIDEO"!==this.tag.tagName&&(this._el=this.tag,this.tag=n.prototype.createEl.call(this,"video"));var t=this._el,e=this.tag;e.player=this;var a=o.getElementAttributes(e);return i.each(a,function(e){t.setAttribute(e,a[e])}),this.setVideoAttrs(),e.parentNode&&e.parentNode.insertBefore(t,e),o.insertFirst(e,t),this.cover=o.createEl("div"),o.addClass(this.cover,"prism-cover"),t.appendChild(this.cover),this.options().cover&&(this.cover.style.backgroundImage="url("+this.options().cover+")"),c.IS_IOS&&o.css(e,"display","none"),t},p.prototype.setVideoAttrs=function(){var t=this._options.preload,e=this._options.autoplay;this.tag.style.width="100%",this.tag.style.height="100%",t&&this.tag.setAttribute("preload","preload"),e&&this.tag.setAttribute("autoplay","autoplay")},p.prototype.id=function(){return this.el().id},p.prototype.renderUI=function(){},p.prototype.bindVideoEvent=function(){var t=this.tag,e=this;a.on(t,"timeupdate",function(){e.trigger("timeupdate")}),a.on(t,"play",function(){e.trigger("play")}),a.on(t,"pause",function(){e.trigger("pause")}),a.on(t,"canplay",function(){e.trigger("canplay")}),a.on(t,"playing",function(){e.trigger("playing")}),a.on(t,"ended",function(){e.trigger("ended")}),a.on(t,"error",function(){e.trigger("error")}),a.on(t,"durationchange",function(){e.trigger("durationchange")}),a.on(t,"loadedmetadata",function(){e.trigger("loadedmetadata")}),a.on(t,"loadeddata",function(){e.trigger("loadeddata")}),a.on(t,"progress",function(){e.trigger("progress")}),a.on(t,"canplaythrough",function(){e.cover&&(o.css(e.cover,"display","none"),delete e.cover),"none"===t.style.display&&c.IS_IOS&&setTimeout(function(){o.css(t,"display","block")},100),e.trigger("canplaythrough")}),a.on(t,"webkitfullscreenchange",function(){e.trigger("fullscreenchange")}),this.on("requestFullScreen",function(){o.addClass(e.el(),"prism-fullscreen")}),this.on("cancelFullScreen",function(){o.removeClass(e.el(),"prism-fullscreen")})},p.prototype.loadVideoInfo=function(){var t=this._options.vid,e=this;if(!t)throw new Error("PrismPlayer Error: vid should not be null!");r.jsonp("//tv.taobao.com/player/json/getBaseVideoInfo.do?vid="+t+"&playerType=3",function(n){if(1!==n.status||!n.data.source)throw new Error("PrismPlayer Error: #vid:"+t+" cannot find video resource!");var o,a=-1;i.each(n.data.source,function(t){var e=+t.substring(1);e>a&&(a=e)}),o=n.data.source["v"+a],o=i.unescape(o),e._options.source=o,e._options.trackLog&&(e._monitor=new l(e,{video_id:t,album_id:n.data.baseInfo.aid,from:e._options.from})),e.trigger("init"),e._options.autoplay&&(e.getMetaData(),e.tag.setAttribute("src",e._options.source),e.readyTime=(new Date).getTime(),e.loaded=!0)},function(){throw new Error("PrismPlayer Error: network error!")})},p.prototype.setControls=function(){var t=this.options();if(t.useNativeControls)this.tag.setAttribute("controls","controls");else if("object"==typeof t.controls){var e=this._initControlBar(t.controls);this.addChild(e)}},p.prototype._initControlBar=function(t){var e=new ControlBar(this,t);return e},p.prototype.getMetaData=function(){var t=this,e=null,n=this.tag;e=window.setInterval(function(){if(n.readyState>0){var i=Math.round(n.duration);t.tag.duration=i,t.readyTime=(new Date).getTime()-t.readyTime,t.trigger("readyState"),clearInterval(e)}},100)},p.prototype.getReadyTime=function(){return this.readyTime},p.prototype.readyState=function(){return this.tag.readyState},p.prototype.getError=function(){return this.tag.error},p.prototype.play=function(){return this._options.autoplay||this.loaded||(this.getMetaData(),this.tag.setAttribute("src",this._options.source),this.readyTime=(new Date).getTime(),this.loaded=!0),this.tag.play(),this},p.prototype.pause=function(){return this.tag.pause(),this},p.prototype.paused=function(){return this.tag.paused===!1?!1:!0},p.prototype.getDuration=function(){var t=this.tag.duration;return t},p.prototype.getCurrentTime=function(){var t=this.tag.currentTime;return t},p.prototype.seek=function(t){t===this.tag.duration&&t--;try{this.tag.currentTime=t}catch(e){console.log(e)}return this},p.prototype.loadByVid=function(t){this._options.vid=t;var e=this;if(!t)throw new Error("PrismPlayer Error: vid should not be null!");r.jsonp("//tv.taobao.com/player/json/getBaseVideoInfo.do?vid="+t+"&playerType=3",function(n){if(1!==n.status||!n.data.source)throw new Error("PrismPlayer Error: #vid:"+t+" cannot find video resource!");var o,a=-1;i.each(n.data.source,function(t){var e=+t.substring(1);e>a&&(a=e)}),o=n.data.source["v"+a],o=i.unescape(o),e._options.source=o,e._options.trackLog&&(e._monitor?e._monitor.updateVideoInfo({video_id:t,album_id:n.data.baseInfo.aid,from:e._options.from}):e._monitor=new l(e,{video_id:t,album_id:n.data.baseInfo.aid,from:e._options.from})),e._options.autoplay=!0,e.loaded||e.trigger("init"),e.getMetaData(),e.tag.setAttribute("src",e._options.source),e.readyTime=(new Date).getTime(),e.loaded=!0,e.tag.play()},function(){throw new Error("PrismPlayer Error: network error!")})},p.prototype.loadByUrl=function(t){this._options.vid=0,this._options.source=t,this._options.autoplay=!0,this._options.trackLog&&(this._monitor?this._monitor.updateVideoInfo({video_id:0,album_id:0,from:this._options.from}):this._monitor=new l(this,{video_id:0,album_id:0,from:this._options.from})),this.loaded||this.trigger("init"),this.getMetaData(),this.tag.setAttribute("src",this._options.source),this.readyTime=(new Date).getTime(),this.loaded=!0,this.tag.play()},p.prototype.dispose=function(){this.tag.pause();var t=this.tag;a.off(t,"timeupdate"),a.off(t,"play"),a.off(t,"pause"),a.off(t,"canplay"),a.off(t,"playing"),a.off(t,"ended"),a.off(t,"error"),a.off(t,"durationchange"),a.off(t,"loadedmetadata"),a.off(t,"loadeddata"),a.off(t,"progress"),a.off(t,"canplaythrough"),a.off(t,"webkitfullscreenchange"),this.tag=null,this._options=null,this._monitor&&(this._monitor.removeEvent(),this._monitor=null)},p.prototype.mute=function(){return this.tag.muted=!0,this},p.prototype.unMute=function(){return this.tag.muted=!1,this},p.prototype.muted=function(){return this.tag.muted},p.prototype.getVolume=function(){return this.tag.volume},p.prototype.setVolume=function(t){this.tag.volume=t};var d=function(){var t,e;e=o.createEl("div"),t={};for(var n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullScreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","webkitfullScreen"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror","webkitfullScreen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","mozfullScreen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","MSFullScreen"]],i=5,a=0;i>a;a++)if(n[a][1]in document){t.requestFn=n[a][0],t.cancelFn=n[a][1],t.eventName=n[a][4],t.isFullScreen=n[a][6];break}return document[t.cancelFn]?t:null}();p.prototype._enterFullWindow=function(){this.isFullWindow=!0,this.docOrigOverflow=document.documentElement.style.overflow,document.documentElement.style.overflow="hidden",o.addClass(document.getElementsByTagName("body")[0],"prism-full-window")},p.prototype._exitFullWindow=function(){this.isFullWindow=!1,document.documentElement.style.overflow=this.docOrigOverflow,o.removeClass(document.getElementsByTagName("body")[0],"prism-full-window")},p.prototype.requestFullScreen=function(){var t=d,e=this.el(),n=this;return this.isFullScreen=!0,t?(a.on(document,t.eventName,function(){n.isFullScreen=document[t.isFullScreen],n.isFullScreen===!1&&a.off(document,t.eventName),n.trigger("requestFullScreen")}),e[t.requestFn]()):(this._enterFullWindow(),this.trigger("requestFullScreen")),this},p.prototype.cancelFullScreen=function(){var t=d,e=this;return this.isFullScreen=!1,t?(a.on(document,t.eventName,function(){e.isFullScreen=document[t.isFullScreen],e.isFullScreen===!0&&a.off(document,t.eventName),e.trigger("cancelFullScreen")}),document[t.cancelFn]()):(this._exitFullWindow(),this.trigger("cancelFullScreen")),this},p.prototype.getIsFullScreen=function(){return this.isFullScreen
},p.prototype.getBuffered=function(){return this.tag.buffered},e.exports=p},{"../lib/dom":5,"../lib/event":6,"../lib/io":8,"../lib/object":10,"../lib/ua":12,"../monitor/monitor":15,"../ui/component":18,"../ui/exports":26}],18:[function(t,e){var n=t("../lib/oo"),i=t("../lib/data"),o=t("../lib/object"),a=t("../lib/dom"),r=t("../lib/event"),s=t("../lib/function"),l=t("../lib/layout"),c=n.extend({init:function(t,e){var n=this;this._player=t,this._options=o.copy(e),this._el=this.createEl(),this._id=t.id()+"_component_"+i.guid(),this._children=[],this._childIndex={},this._player.on("uiReady",function(){n.renderUI(),n.syncUI(),n.bindEvent()})}});c.prototype.renderUI=function(){l.render(this.el(),this.options()),this.el().id=this.id()},c.prototype.syncUI=function(){},c.prototype.bindEvent=function(){},c.prototype.createEl=function(t,e){return a.createEl(t,e)},c.prototype.options=function(t){return void 0===t?this._options:this._options=o.merge(this._options,t)},c.prototype.el=function(){return this._el},c.prototype._contentEl,c.prototype.player=function(){return this._player},c.prototype.contentEl=function(){return this._contentEl||this._el},c.prototype._id,c.prototype.id=function(){return this._id},c.prototype.addChild=function(t,e){var n;if("string"==typeof t){if(!this._player.UI[t])return;n=new this._player.UI[t](this._player,e)}else n=t;return this._children.push(n),"function"==typeof n.id&&(this._childIndex[n.id()]=n),"function"==typeof n.el&&n.el()&&this.contentEl().appendChild(n.el()),n},c.prototype.removeChild=function(t){if(t&&this._children){for(var e=!1,n=this._children.length-1;n>=0;n--)if(this._children[n]===t){e=!0,this._children.splice(n,1);break}if(e){this._childIndex[t.id]=null;var i=t.el();i&&i.parentNode===this.contentEl()&&this.contentEl().removeChild(t.el())}}},c.prototype.initChildren=function(){var t,e,n,i,a;if(t=this,e=this.options().children)if(o.isArray(e))for(var r=0;r<e.length;r++)n=e[r],"string"==typeof n?(i=n,a={}):(i=n.name,a=n),t.addChild(i,a);else o.each(e,function(e,n){n!==!1&&t.addChild(e,n)})},c.prototype.on=function(t,e){return r.on(this._el,t,s.bind(this,e)),this},c.prototype.off=function(t,e){return r.off(this._el,t,e),this},c.prototype.one=function(t,e){return r.one(this._el,t,s.bind(this,e)),this},c.prototype.trigger=function(t,e){return e&&(this._el.paramData=e),r.trigger(this._el,t),this},c.prototype.addClass=function(t){return a.addClass(this._el,t),this},c.prototype.removeClass=function(t){return a.removeClass(this._el,t),this},c.prototype.show=function(){return this._el.style.display="block",this},c.prototype.hide=function(){return this._el.style.display="none",this},c.prototype.destroy=function(){if(this.trigger({type:"destroy",bubbles:!1}),this._children)for(var t=this._children.length-1;t>=0;t--)this._children[t].destroy&&this._children[t].destroy();this.children_=null,this.childIndex_=null,this.off(),this._el.parentNode&&this._el.parentNode.removeChild(this._el),i.removeData(this._el),this._el=null},e.exports=c},{"../lib/data":4,"../lib/dom":5,"../lib/event":6,"../lib/function":7,"../lib/layout":9,"../lib/object":10,"../lib/oo":11}],19:[function(t,e){var n=t("../component"),i=t("../../lib/dom"),o=n.extend({init:function(t,e){n.call(this,t,e),this.addClass(e.className||"prism-big-play-btn")},bindEvent:function(){var t=this;this._player.on("play",function(){t.addClass("playing"),i.css(t.el(),"display","none")}),this.on("click",function(){t._player.paused()&&(t._player.play(),i.css(t.el(),"display","none"))})}});e.exports=o},{"../../lib/dom":5,"../component":18}],20:[function(t,e){var n=t("../component"),i=n.extend({init:function(t,e){n.call(this,t,e),this.addClass(e.className||"prism-controlbar"),this.initChildren(),this.onEvent()},createEl:function(){var t=n.prototype.createEl.call(this);return t.innerHTML='<div class="prism-controlbar-bg"></div>',t},onEvent:function(){var t=this.player(),e=this;this.timer=null,t.on("click",function(t){t.preventDefault(),t.stopPropagation(),e._show(),e._hide()}),t.on("ready",function(){e._hide()}),this.on("touchstart",function(){e._show()}),this.on("touchmove",function(){e._show()}),this.on("touchend",function(){e._hide()})},_show:function(){this.show(),this.timer&&(clearTimeout(this.timer),this.timer=null)},_hide:function(){var t=this;this.timer=setTimeout(function(){t.hide()},5e3)}});e.exports=i},{"../component":18}],21:[function(t,e){var n=t("../component"),i=n.extend({init:function(t,e){n.call(this,t,e),this.addClass(e.className||"prism-fullscreen-btn")},bindEvent:function(){var t=this;this._player.on("requestFullScreen",function(){t.addClass("fullscreen")}),this._player.on("cancelFullScreen",function(){t.removeClass("fullscreen")}),this.on("click",function(){this._player.getIsFullScreen()?this._player.cancelFullScreen():this._player.requestFullScreen()})}});e.exports=i},{"../component":18}],22:[function(t,e){var n=t("../component"),i=n.extend({init:function(t,e){n.call(this,t,e),this.addClass(e.className||"prism-play-btn")},bindEvent:function(){var t=this;this._player.on("play",function(){t.addClass("playing")}),this._player.on("pause",function(){t.removeClass("playing")}),this.on("click",function(){t._player.paused()?(t._player.play(),t.addClass("playing")):(t._player.pause(),t.removeClass("playing"))})}});e.exports=i},{"../component":18}],23:[function(t,e){var n=t("../component"),i=t("../../lib/dom"),o=t("../../lib/event"),a=t("../../lib/ua"),r=t("../../lib/function"),s=n.extend({init:function(t,e){n.call(this,t,e),this.className=e.className?e.className:"prism-progress",this.addClass(this.className)},createEl:function(){var t=n.prototype.createEl.call(this);return t.innerHTML='<div class="prism-progress-loaded"></div><div class="prism-progress-played"></div><div class="prism-progress-cursor"></div>',t},bindEvent:function(){var t=this;this.loadedNode=document.querySelector("#"+this.id()+" .prism-progress-loaded"),this.playedNode=document.querySelector("#"+this.id()+" .prism-progress-played"),this.cursorNode=document.querySelector("#"+this.id()+" .prism-progress-cursor"),o.on(this.cursorNode,"mousedown",function(e){t._onMouseDown(e)}),o.on(this.cursorNode,"touchstart",function(e){t._onMouseDown(e)}),this.bindTimeupdate=r.bind(this,this._onTimeupdate),this._player.on("timeupdate",this.bindTimeupdate),a.IS_IPAD?this.interval=setInterval(function(){t._onProgress()},500):this._player.on("progress",function(){t._onProgress()})},_onMouseDown:function(t){var e=this;t.preventDefault(),this._player.pause(),this._player.trigger("seekStart",{fromTime:this._player.getCurrentTime()}),o.on(this.cursorNode,"mousemove",function(t){e._onMouseMove(t)}),o.on(this.cursorNode,"mouseup",function(t){e._onMouseUp(t)}),o.on(this.cursorNode,"touchmove",function(t){e._onMouseMove(t)}),o.on(this.cursorNode,"touchend",function(t){e._onMouseUp(t)})},_onMouseUp:function(t){t.preventDefault(),o.off(this.cursorNode,"mousemove"),o.off(this.cursorNode,"mouseup"),o.off(this.cursorNode,"touchmove"),o.off(this.cursorNode,"touchend");var e=this.playedNode.offsetWidth/this.el().offsetWidth*this._player.getDuration();this._player.seek(e),this._player.play(),this._player.trigger("seekEnd",{toTime:this._player.getCurrentTime()})},_onMouseMove:function(t){t.preventDefault();var e=t.touches?t.touches[0].pageX:t.pageX,n=e-this.el().offsetLeft,i=this.el().offsetWidth,o=this._player.getDuration()?n/i*this._player.getDuration():0;0>o&&(o=0),o>this._player.getDuration()&&(o=this._player.getDuration()),this._player.seek(o)},_onTimeupdate:function(){this._updateProgressBar(this.playedNode,this._player.getCurrentTime()),this._updateCursorPosition(this._player.getCurrentTime()),this._player.trigger("updateProgressBar",{time:this._player.getCurrentTime()})},_onProgress:function(){this._player.getDuration()&&this._updateProgressBar(this.loadedNode,this._player.getBuffered().end(this._player.getBuffered().length-1))},_updateProgressBar:function(t,e){var n=this._player.getDuration()?e/this._player.getDuration():0;i.css(t,"width",100*n+"%")},_updateCursorPosition:function(t){var e=this._player.getDuration()?t/this._player.getDuration():0;i.css(this.cursorNode,"left",100*e+"%")}});e.exports=s},{"../../lib/dom":5,"../../lib/event":6,"../../lib/function":7,"../../lib/ua":12,"../component":18}],24:[function(t,e){var n=t("../component"),i=t("../../lib/util"),o=n.extend({init:function(t,e){n.call(this,t,e),this.className=e.className?e.className:"prism-time-display",this.addClass(this.className)},createEl:function(){var t=n.prototype.createEl.call(this,"div");return t.innerHTML='<span class="current-time">00:00</span> <span class="time-bound">/</span> <span class="duration">00:00</span>',t},bindEvent:function(){var t=this;this._player.on("durationchange",function(){var e=i.formatTime(t._player.getDuration());e?document.querySelector("#"+t.id()+" .duration").innerHTML=e:(document.querySelector("#"+t.id()+" .duration").style.display="none",document.querySelector("#"+t.id()+" .time-bound").style.display="none")}),this._player.on("timeupdate",function(){var e=i.formatTime(t._player.getCurrentTime());e?document.querySelector("#"+t.id()+" .current-time").innerHTML=e:document.querySelector("#"+t.id()+" .current-time").style.display="none"})}});e.exports=o},{"../../lib/util":14,"../component":18}],25:[function(t,e){var n=t("../component"),i=n.extend({init:function(t,e){n.call(this,t,e),this.addClass(e.className||"prism-volume")},bindEvent:function(){var t=this;this.on("click",function(){t._player.muted()?(t._player.unMute(),t.removeClass("mute")):(t._player.mute(),t.addClass("mute"))})}});e.exports=i},{"../component":18}],26:[function(t,e){e.exports={bigPlayButton:t("./component/big-play-button"),controlBar:t("./component/controlbar"),progress:t("./component/progress"),playButton:t("./component/play-button"),timeDisplay:t("./component/time-display"),fullScreenButton:t("./component/fullscreen-button"),volume:t("./component/volume")}},{"./component/big-play-button":19,"./component/controlbar":20,"./component/fullscreen-button":21,"./component/play-button":22,"./component/progress":23,"./component/time-display":24,"./component/volume":25}]},{},[2]);var username_short="",username="";document.cookie.split(";").forEach(function(t){-1!==t.indexOf("jpaUser")&&(username=t.split("=")[1],username=decodeURIComponent(username),username_short=username.split("|")[0])}),angular.module("admin",["kai","ui.router","ngFileUpload"]).constant("kai.mainNavTitle",'<h1 style="margin:0;padding;0;font-size:20px;font-weight:100;">后台管理<sup>pre</sup></h1>').constant("kai.mainNavUser",username_short).constant("kai.mainNavList",[{key:"mts",title:"媒体转码",icon:"fa fa-ship",url:"#/mts/template/list"},{key:"user",title:"用户管理",icon:"fa fa-group",url:"#/user/list"}]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("mts",{"abstract":!0,url:"/mts",templateUrl:"app/controller/mts/index.html",controller:"MtsIndexCtrl"}).state("mts.list",{url:"/template/list",data:{sideNav:"template"},templateUrl:"app/controller/mts/template/list.html",controller:"MtsListCtrl"}).state("mts.form",{url:"/template/:method/:id",data:{sideNav:"template"},templateUrl:"app/controller/mts/template/form.html",controller:"MtsModalCtrl"}).state("mts.wmList",{url:"/watermark/list",data:{sideNav:"watermark"},templateUrl:"app/controller/mts/watermark/list.html",controller:"MtsWaterMarkListCtrl"}).state("mts.wmForm",{url:"/watermark/:method/:id",data:{sideNav:"watermark"},templateUrl:"app/controller/mts/watermark/form.html",controller:"MtsWaterMarkFormCtrl"}).state("mts.jobTemplateList",{url:"/jt/list",data:{sideNav:"jt"},templateUrl:"app/controller/mts/jobTemplate/list.html",controller:"MtsJobTemplateListCtrl"}).state("mts.jobTemplateForm",{url:"/jt/:method/:id",data:{sideNav:"jt"},templateUrl:"app/controller/mts/jobTemplate/form.html",controller:"MtsJobTemplateFormCtrl"}).state("mts.jobHistory",{url:"/jh/list",data:{sideNav:"jh"},templateUrl:"app/controller/mts/jobHistory/list.html",controller:"MtsJobHistoryListCtrl"}).state("mts.videoList",{url:"/video/list",data:{sideNav:"video"},templateUrl:"app/controller/mts/video/list.html",controller:"MtsVideoListCtrl"}).state("mts.videoForm",{url:"/video/form/:id",data:{sideNav:"video"},templateUrl:"app/controller/mts/video/form.html",controller:"MtsVideoFormCtrl"}).state("user",{"abstract":!0,url:"/user",templateUrl:"app/controller/user/index.html",controller:"UserIndexCtrl"}).state("user.list",{url:"/list",data:{sideNav:"list"},templateUrl:"app/controller/user/list/list.html",controller:"UserListCtrl"}).state("user.form",{url:"/form/:method/:id",data:{sideNav:"list"},templateUrl:"app/controller/user/form/form.html",controller:"UserFormCtrl"}),e.otherwise("/mts/template/list")}]),angular.module("admin").controller("UserListCtrl",["$scope","$ajax","$state",function(t,e,n){t.fields=[{key:"id",title:"ID"},{key:"username",title:"用户名"},{key:"authorities",title:"权限"},{key:"enabled",title:"可用"}],t.options={search:!1,checkbox:!1,pagination:{itemsPerPage:10,current:1},buttons:[{className:"text-primary",icon:"fa fa-edit",title:"Edit",action:function(t){n.go("user.form",{method:"edit",id:t.id},{inherit:!0})}},{className:"text-danger",icon:"fa fa-trash",title:"Del",action:function(){}}]},t.rows=[],e.get("/admin/api/user").done(function(e){t.rows=e})}]),angular.module("admin").controller("UserFormCtrl",["$scope","$stateParams","$ajax","dialogService","$state",function(t,e,n,i,o){var a=e.method,r=e.id;t.loaded=!1,t.method=a,t.baseInfo={add:{title:"新建用户"},edit:{title:"编辑用户"}}[a];var s={auth:{}};"edit"===a&&r?n.get("/admin/api/user/"+r).fail(function(){}).done(function(e){var n=e.authorities.split(",");e.auth={},-1!=n.indexOf("ROLE_USER")&&(e.auth.ROLE_USER=!0),-1!=n.indexOf("ROLE_ADMIN")&&(e.auth.ROLE_ADMIN=!0),t.template=_.merge(s,e),t.loaded=!0}):(t.template=s,t.loaded=!0),t.submitHandler=function(){i.prompt({icon:"info",content:"确定保存?"}).done(function(){var e=_.cloneDeep(t.template),a=[];_.each(e.auth,function(t,e){t&&a.push(e)}),e.authorities=a.join(","),delete e.auth,n.post("/admin/api/user/update",{id:e.id,authorities:e.authorities,enabled:e.enabled}).fail(function(t){i.alert({icon:"error",content:t})}).done(function(){i.alert({icon:"success",content:"保存成功"}).done(function(){o.go("user.list")})})})}}]),angular.module("admin").controller("MtsWaterMarkListCtrl",["$scope","$ajax","$state","dialogService",function(t,e,n,i){function o(n,i){n=n||1,i=i||10,e.get("/admin/api/mts/watermarks",{pageNumber:n,pageSize:i}).fail(function(){}).done(function(e){t.options.pagination.current=n,t.options.pagination.itemsPerPage=i,t.options.pagination.totalItems=e.count,t.rows=e.list})}t.init=function(){t.options={search:!1,checkbox:!1,pagination:{itemsPerPage:10,current:1},topButtons:[{className:"btn btn-primary btn-sm",icon:"fa fa-plus",title:"Add",action:function(){n.go("mts.wmForm",{method:"add",id:1*new Date},{inherit:!0})}}],buttons:[{className:"text-primary",icon:"fa fa-edit",title:"Edit",action:function(t){n.go("mts.wmForm",{method:"edit",id:t.id},{inherit:!0})}},{className:"text-danger",icon:"fa fa-trash",title:"Del",action:function(t){i.prompt({icon:"warning",content:"确定删除 "+t.name+" ?"}).done(function(){e["delete"]("/admin/api/mts/watermark/"+t.id).fail(function(t){i.alert({icon:"error",content:t})}).done(function(){i.alert({icon:"success",content:"删除成功!"}).done(function(){o()})})})}}]},t.fields=[{key:"id",title:"ID",sort:"string"},{key:"name",title:"名称",sort:"string"},{key:"state",title:"状态",sort:"string",valueHandler:function(t){switch(t){case"Normal":t='<span class="text-success">'+t+"</span>";break;case"Deleted":t='<span class="text-danger">'+t+"</span>"}return t}},{key:"referPos",title:"位置",valueHandler:function(t){return t.format}}],t.rows=[],o()}}]),angular.module("admin").controller("MtsWaterMarkFormCtrl",["$scope","$stateParams","$ajax","dialogService","$state",function(t,e,n,i,o){function a(t){var e={};return _.each(t,function(t,n){n=_.capitalize(n),e[n]=_.isPlainObject(t)?a(t):t}),e}var r=e.method,s=e.id;t.loaded=!1,t.method=r,t.baseInfo={add:{title:"新建水印模板"},edit:{title:"编辑水印模板"}}[r],t.formBasic={referPos:["TopRight","TopLeft","BottomRight","BottomLeft"]};var l={config:{width:"10",height:"30",dx:"10",dy:"5",referPos:"TopLeft",type:"Image"}};"edit"===r&&s?n.get("/admin/api/mts/watermark/"+s).fail(function(){}).done(function(e){return e&&e.length?(e={config:e[0]},e.id=e.config.id,e.name=e.config.name,delete e.config.id,delete e.config.name,delete e.config.state,t.template=_.merge(l,e),void(t.loaded=!0)):void i.alert({icon:"fa fa-error",content:"模板不存在!"})}):(t.template=l,t.loaded=!0),t.submitHandler=function(){i.prompt({icon:"info",content:"确定保存?"}).done(function(){var e=_.cloneDeep(t.template);e=a(e),_.each(e,function(t,n){_.isObject(t)&&(e[n]=JSON.stringify(t))}),n.post("/admin/api/mts/watermark",e).fail(function(t){i.alert({icon:"error",content:t})}).done(function(){i.alert({icon:"success",content:"保存成功"}).done(function(){o.go("mts.wmList")})})})}}]),angular.module("admin").controller("MtsVideoListCtrl",["$scope","$ajax","$filter","$timeout","$state",function(t,e,n,i,o){function a(n,o){n=n||1,o=o||10,e.get("/admin/api/video/list",{pageNumber:n,pageSize:o}).fail(function(){}).done(function(e){t.rows=e.list,i(function(){t.options.pagination.totalItems=e.count})})}function r(t){return n("date")(t,"yyyy-MM-dd HH:mm:ss")}t.init=function(){t.options={pagination:{itemsPerPage:10,current:1,action:function(t){a(t,10)}},search:!1,checkbox:!1,topButtons:[{className:"btn btn-primary btn-sm",icon:"fa fa-plus",title:"上传视频",action:function(){o.go("mts.videoForm",{id:-1},{inherit:!0})}}],buttons:[{className:"text-primary",icon:"fa fa-edit",title:"编辑",action:function(t){o.go("mts.videoForm",{id:t.id},{inherit:!0})}}]},t.fields=[{key:"id",title:"id"},{key:"title",title:"Title"},{key:"description",title:"DESC"},{key:"isDelete",title:"文件状态",valueHandler:function(t){return t=t?'<span class="text-danger">Deleted</span>':'<span class="text-success">Normal</span>'}},{key:"gmt_created",title:"创建时间",valueHandler:function(t){return r(t)}},{key:"father",title:"级别",valueHandler:function(t){return t&&0!=t?"转码文件, 源文件id:"+t:"原始文件"}},{key:"status",title:"审核状态",valueHandler:function(t){switch(t=1*t){case 0:t='<span class="text-warning">待审核</span>';break;case 1:t='<span class="text-success">通过</span>';break;case 2:t='<span class="text-danger">不通过</span>';break;case 3:t='<span class="text-info">转码中</span>';break;case 4:t='<span class="text-info">转码失败</span>';break;case 5:t='<span class="text-info">执行转码</span>'}return t}}],t.rows=[],a()}}]),angular.module("admin").controller("MtsVideoFormCtrl",["$scope","$ajax","$stateParams","$http","$state","dialogService",function(t,e,n,o,a,r){function s(e){return e.baseInfo||(e.baseInfo={}),void 0===e.baseInfo.status&&(e.baseInfo.status=t.statusList[0].value),void 0===e.isTranscode&&(e.isTranscode="false"),e}var l=1*n.id;t.isNew=-1===l,t.statusList=[{value:0,title:"待审核"},{value:1,title:"通过"},{value:2,title:"不通过"},{value:3,title:"转码中"},{value:4,title:"转码失败"},{value:5,title:"执行转码"}],t.save2oss=function(t){t.preventDefault(),e.get("/api/sts/assumeWriteRole").done(function(t){var e=new OssUpload({bucket:"multimedia-input",endpoint:"http://oss-cn-hangzhou.aliyuncs.com",chunkSize:1048576,concurrency:2,stsToken:t});e.upload({file:files[i],key:"user/01/file_key",maxRetry:3,headers:{CacheControl:"public",Expires:"",ContentEncoding:"",ContentDisposition:"",ServerSideEncryption:""},onprogress:function(t){console.log(t)},onerror:function(t){console.log(t)},oncomplete:function(t){console.log(t)}})})},t.save=function(e){e.preventDefault(),r.prompt({icon:"warning",content:"确定保存修改?"}).done(function(){var e=[],n=new FormData,i=$(".mediaInput").get(0).files[0],s=$(".picInput").get(0).files[0];n.append("mediaFile",i),n.append("picFile",s),e.push("desc="+t.data.baseInfo.description),e.push("title="+t.data.baseInfo.title),t.data.isTranscode&&e.push("isTranscode="+t.data.isTranscode);var c="";-1!==l?(e.push("id="+l),e.push("status="+t.data.baseInfo.status),c="/admin/api/video/updateMediaAndPicStatus?"):c="/admin/api/video/updateMediaAndPicStatus?",e=e.join("&"),c+=e,o.post(c,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).error(function(){}).success(function(){r.alert({icon:"success",content:"保存成功"}).done(function(){a.go("mts.videoList")})})})},t.init=function(){-1!==l?(t.baseInfo={title:"编辑视频"},e.get("/admin/api/video/get/"+l).done(function(e){t.data=s(e)})):(t.baseInfo={title:"新上传视频"},t.data=s({}))}}]),angular.module("admin").controller("MtsListCtrl",["$scope","$ajax","$state","dialogService",function(t,e,n,i){function o(n,i){n=n||1,i=i||10,e.get("/admin/api/mts/templates",{pageNumber:n,pageSize:i}).fail(function(){}).done(function(e){t.options.pagination.current=n,t.options.pagination.itemsPerPage=i,t.options.pagination.totalItems=e.count,t.rows=e.list})}t.init=function(){t.options={search:!1,checkbox:!1,pagination:{itemsPerPage:10,current:1},topButtons:[{className:"btn btn-primary btn-sm",icon:"fa fa-plus",title:"Add",action:function(){n.go("mts.form",{method:"add",id:1*new Date},{inherit:!0})}}],buttons:[{className:"text-primary",icon:"fa fa-edit",title:"Edit",action:function(t){n.go("mts.form",{method:"edit",id:t.id},{inherit:!0})}},{className:"text-danger",icon:"fa fa-trash",title:"Del",action:function(t){i.prompt({icon:"warning",content:"确定删除 "+t.name+" ?"}).done(function(){e["delete"]("/admin/api/mts/template/"+t.id).fail(function(t){i.alert({icon:"error",content:t})}).done(function(){i.alert({icon:"success",content:"删除成功!"}).done(function(){o()})})})}}]},t.fields=[{key:"id",title:"ID",sort:"string"},{key:"name",title:"名称",sort:"string"},{key:"state",title:"状态",sort:"string",valueHandler:function(t){switch(t){case"Normal":t='<span class="text-success">'+t+"</span>";break;case"Deleted":t='<span class="text-danger">'+t+"</span>"}return t}},{key:"container",title:"格式",valueHandler:function(t){return t.format}}],t.rows=[],o()}}]),angular.module("admin").controller("MtsModalCtrl",["$scope","$stateParams","$ajax","dialogService","$state",function(t,e,n,i,o){function a(t){var e={};return _.each(t,function(t,n){n=_.capitalize(n),e[n]=_.isPlainObject(t)?a(t):t}),e}var r=e.method,s=e.id;t.loaded=!1,t.baseInfo={add:{title:"新建转码模板"},edit:{title:"编辑转码模板"}}[r],t.formBasic={fileType:["flv","mp4","ts","m3u8","mp3","ogg","flac"],videoCodec:function(t){return"flv"===t?["H.264"]:["H.264","H.265"]},videoProfile:["baseline","main","high"],videoPreset:["veryfast","fast","medium","slow","slower"],videoScanMode:["interlaced","progressive"],videoPixFmt:["yuv420p","yuvj420p"],audioCodec:["AAC","MP3","VORBIS","FLAC"],audioProfile:["aac_low","aac_he","aac_he_v2","aac_ld","aac_eld"],audioSamplerate:function(t,e){return"flv"===t&&"MP3"===e?["22050","44100"]:"MP3"===e?["22050","32000","44100","48000"]:["22050","32000","44100","48000","96000"]},audioChannels:function(t){return"AAC"===t?[1,2,4,5,6,8]:[1,2]}};var l={container:{format:"mp4"},video:{codec:"H.264",profile:"high",bitrate:"500",crf:"15",width:null,height:null,fps:"25",gop:"10",preset:"medium",bufsize:"6000",bitrateBnd:{max:null,min:null},pixFmt:"yuv420p"},audio:{codec:"AAC",samplerate:"44100",bitrate:"500",channels:"2"},transConfig:{transMode:"fixCRF"},muxConfig:{segment:{duration:"12"}}};"edit"===r&&s?n.get("/admin/api/mts/template/"+s).fail(function(){}).done(function(e){return e&&e.length?(t.template=_.merge(l,e[0]),void(t.loaded=!0)):void i.alert({icon:"fa fa-error",content:"模板不存在!"})}):(t.template=l,t.loaded=!0),t.submitHandler=function(){i.prompt({icon:"info",content:"确定保存?"}).done(function(){var e=_.cloneDeep(t.template);e=a(e),_.each(e,function(t,n){_.isObject(t)&&(e[n]=JSON.stringify(t))}),n.post("/admin/api/mts/template",e).fail(function(t){i.alert({icon:"error",content:t})}).done(function(){i.alert({icon:"success",content:"保存成功"}).done(function(){o.go("mts.list")})})})}}]),angular.module("admin").controller("MtsJobTemplateListCtrl",["$scope","$ajax","$state","dialogService","$filter",function(t,e,n,i,o){function a(){e.get("/admin/api/mts/jt",{}).fail(function(){}).done(function(e){t.rows=e})}t.init=function(){t.options={search:!1,checkbox:!1,pagination:{itemsPerPage:10,current:1},topButtons:[{className:"btn btn-primary btn-sm",icon:"fa fa-plus",title:"Add",action:function(){n.go("mts.jobTemplateForm",{method:"add",id:1*new Date},{inherit:!0})}}],buttons:[{className:"text-primary",icon:"fa fa-edit",title:"Edit",action:function(t){n.go("mts.jobTemplateForm",{method:"edit",id:t.id},{inherit:!0})}},{className:"text-danger",icon:"fa fa-trash",title:"Del",action:function(t){i.prompt({icon:"warning",content:"确定删除 "+t.name+" ?"}).done(function(){e["delete"]("/admin/api/mts/jt/"+t.id).fail(function(t){i.alert({icon:"error",content:t})}).done(function(){i.alert({icon:"success",content:"删除成功!"}).done(function(){a()})})})}}]},t.fields=[{key:"id",title:"ID",sort:"number"},{key:"name",title:"名称",sort:"string"},{key:"desc",title:"描述"},{key:"pipelineId",title:"管道ID"},{key:"using",title:"使用中",sort:"string",valueHandler:function(t){return t?'<span class="text-success">是</span>':'<span class="text-muted">否</span>'}},{key:"adminId",title:"操作人",valueHandler:function(t){return t}},{key:"lastUpdate",title:"最后更新时间",valueHandler:function(t){return t=o("date")(1e3*t,"yyyy-MM-dd HH:mm:ss")}}],t.rows=[],a()}}]),angular.module("admin").controller("MtsJobTemplateFormCtrl",["$scope","$stateParams","$ajax","dialogService","$state","pipelineService",function(t,e,n,i,o,a){function r(){var e=document.getElementById("jsoneditor"),n=JSON.parse(t.template.outputs);t.editor=new JSONEditor(e,{mode:"code"},n)}var s=e.method,l=e.id;t.loaded=!1,a.getPipelines().done(function(e){t.pipelines=e}),t.method=s,t.baseInfo={add:{title:"新建转码作业模板"},edit:{title:"编辑转码作业模板"}}[s],t.formBasic={referPos:["TopRight","TopLeft","BottomRight","BottomLeft"]},t.initJSONEditor=r;var c={name:null,desc:null,outputs:null,pipelineId:null,outputBucket:null,outputLocation:"oss-cn-hangzhou",adminId:null,lastUpdate:null,using:!1};"edit"===s&&l?n.get("/admin/api/mts/jt",{id:l}).fail(function(){}).done(function(e){return e&&e.length?(t.template=_.merge(c,e[0]),void(t.loaded=!0)):void i.alert({icon:"fa fa-error",content:"模板不存在!"})}):(t.template=c,t.loaded=!0),t.submitHandler=function(){i.prompt({icon:"info",content:"确定保存?"}).done(function(){var e=_.cloneDeep(t.template);e.lastUpdate=~~(new Date/1e3);var a=t.editor.get();a=JSON.stringify(a),e.outputs=a,n.post("/admin/api/mts/jt",e).fail(function(t){i.alert({icon:"error",content:t})}).done(function(){i.alert({icon:"success",content:"保存成功"}).done(function(){o.go("mts.jobTemplateList")})})})}}]),angular.module("admin").controller("MtsJobHistoryListCtrl",["$scope","$ajax","$state","dialogService","$filter",function(t,e,n,i,o){function a(n,i){n=n||1,i=i||100,e.get("/api/mts/jobhistory/list",{pageNumber:n,pageSize:i}).fail(function(){}).done(function(e){t.rows=e})}function r(t){return'<a href="'+t+'">'+t+"</a>"}function s(t){return o("date")(t,"yyyy-MM-dd HH:mm:ss")}t.init=function(){t.options={search:!1,checkbox:!1,pagination:{itemsPerPage:10,current:1},topButtons:[],buttons:[]},t.fields=[{key:"jobAction",title:"jobAction"},{key:"inputUrl",title:"input",valueHandler:r},{key:"outputUrl",title:"outputUrl",valueHandler:r},{key:"status",title:"status"},{key:"gmtCreated",title:"created",valueHandler:s},{key:"gmtModified",title:"modified",valueHandler:s},{key:"deleted",title:"已删除"}],t.rows=[],a()}}]),angular.module("admin").controller("UserIndexCtrl",["$scope",function(t){t.siderNavList=[{key:"list",title:"用户列表",url:"#/user/list"}]}]),angular.module("admin").controller("MtsIndexCtrl",["$scope",function(t){t.siderNavList=[{key:"template",title:"转码模板",url:"#/mts/template/list"},{key:"watermark",title:"水印模板",url:"#/mts/watermark/list"},{key:"jt",title:"转码作业模板",url:"#/mts/jt/list"},{key:"video",title:"视频文件管理",url:"#/mts/video/list"},{key:"jh",title:"转码作业记录",url:"#/mts/jh/list"}]}]),angular.module("kai").controller("kai.AjaxTableCtrl",["$scope","tableSortService","utilsService","$filter",function(t,e,n,i){function o(){}t.$watch("rows",function(){t.init()}),t.filterKeyWords=function(){var e=t.searchFilter,n=i("filter");t.filtedRows=n(t.rows,e),t.options.pagination.totalItems=t.filtedRows.length,o()},t.init=function(){t.options=t.options||{},t.options.colspan=t.fields.length,t.options.buttons.length&&(t.options.colspan+=1),t.options.checkbox&&(t.options.colspan+=1),t.filtedRows=[],t.options.pagination=t.options.pagination||{};var e={totalItems:t.filtedRows.length,maxSize:5,itemsPerPage:2,boundaryLinks:!0,rotate:!1,previousText:"上一页",nextText:"下一页",firstText:"首页",lastText:"尾页",perPageOptions:[{value:10,title:10},{value:20,title:20},{value:50,title:50}],action:function(){}};_.each(e,function(e,n){"undefined"==typeof t.options.pagination[n]&&(t.options.pagination[n]=e)}),t.theRows=t.rows},t.valueOfKey=function(t,e){var i=n.getObjectValueByKeyChain(t,e);return 0===i&&(i="0"),i},t.checkboxHandler=function(e){if(e){var n=!0;_.each(t.rows,function(t){t.checked||(n=!1)}),t.allChecked=n}else _.each(t.rows,function(e){e.checked=t.allChecked})},t.sort=function(n){e.sort(n,t,"filtedRows"),o()}}]),angular.module("admin").controller("kai.Player",["$scope","Upload",function(t){t.$watch("source",function(e){null!==e&&(e="//"+location.host+"/"+e,t.player=new prismplayer({id:"J_prismPlayer",source:e,autoplay:!1,width:"400px",height:"300px"}))}),t.init=function(){}}]),angular.module("admin").controller("admin.AdminSiderNavCtrl",["$scope","$location","$state",function(t,e,n){function i(){t.currentTab=n.current.data.sideNav}t.init=function(){},t.$on("$stateChangeSuccess",function(){i()}),i()}]),angular.module("admin").controller("admin.AdminNavCtrl",["$scope","$location","kai.mainNavList","kai.mainNavTitle","kai.mainNavUser",function(t,e,n,i,o){function a(){var n=e.path();n&&(n=n.match(/^\/([^/]+)/)[1],t.currentTab=n)}t.list=n,t.title=i,t.username=o,t.$on("$routeChangeStart",function(){a()}),t.$on("$stateChangeSuccess",function(){a()}),a()}]),angular.module("admin").service("pipelineService",["$ajax",function(t){var e=this;e.getPipelines=function(){return t.get("/api/mts/pipeline/user/searchpipelinebystate")}}]),angular.module("admin").directive("adminSiderNav",function(){return{restrict:"A",scope:{list:"=list"},templateUrl:"app/component/AdminSiderNav/AdminSiderNav.html",controller:"admin.AdminSiderNavCtrl"}}),angular.module("admin").directive("adminNavbar",function(){return{restrict:"A",scope:{list:"=list"},templateUrl:"app/component/AdminNav/AdminNav.html",controller:"admin.AdminNavCtrl"}}),angular.module("admin").directive("textRange",function(){return{require:"ngModel",scope:{textMax:"=",textMin:"="},link:function(t,e,n,i){var o=1*n.textMax,a=1*n.textMin;i.$parsers.unshift(function(t){return o&&(1*t>o?i.$setValidity("max",!1):i.$setValidity("max",!0)),a&&(a>1*t?i.$setValidity("min",!1):i.$setValidity("min",!0)),t})}}}),angular.module("admin").directive("kaiPlayer",function(){return{restrict:"A",scope:{source:"="},templateUrl:"app/component/player/player.html",controller:"kai.Player"}}),angular.module("kai").directive("kaiAjaxTable",function(){return{restrict:"A",scope:{options:"=",fields:"=",rows:"="},templateUrl:"app/component/table/ajaxTable.html",controller:"kai.AjaxTableCtrl"}}),angular.module("admin").run(["$templateCache",function(t){t.put("app/component/AdminNav/AdminNav.html",'<div class="navbar navbar-default navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><div bind-html-unsafe="title" class="navbar-brand"></div></div><div id="bs-example-navbar-collapse-6" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li ng-repeat="item in list" ng-class="{true: \'active\'}[currentTab == item.key]"><a ng-href="{{item.url}}"><i style="margin-right: 5px;" class="{{item.icon}}"></i>&nbsp;{{item.title}}</a></li></ul><ul class="nav navbar-nav navbar-right"><li class="nav-user">{{username}}</li></ul></div></div></div>'),t.put("app/component/AdminSiderNav/AdminSiderNav.html",'<div ng-init="init()" class="kai-sider-nav"><ul class="nav-list"><li ng-repeat="item in list" ng-class="{true:\'active\'}[item.key==currentTab]"><a href="{{item.url}}"><i class="pull-left {{item.icon}}"></i><span class="pull-left">{{item.title}}</span><i class="fa fa-angle-right pull-right"></i></a></li></ul></div>'),t.put("app/component/player/player.html",'<link rel="stylesheet" href="//g.alicdn.com/de/prismplayer/1.2.16/skins/default/index-min.css"><div ng-init="init()"><div id="J_prismPlayer" class="prism-player"></div></div>'),t.put("app/component/table/ajaxTable.html",'<div ng-init="init()" class="kai-table-wrap"><div style="margin-bottom:10px" class="clearfix"><div style="padding-left:0" ng-show="options.search" class="col-md-4"><div class="input-group input-group-sm"><span class="input-group-addon"><i class="fa fa-search"></i></span> <input ng-model="searchFilter" ng-change="filterKeyWords()" type="text" class="form-control"></div></div><div style="padding-right:0;padding-left:0" class="col-md-8"><button ng-repeat="b in options.topButtons" ng-class="{true:\'pull-right ml5\', false:\'mr5\'}[options.search]" style="padding-left:20px;padding-right:20px" ng-click="b.action()" class="{{b.className}}"><i ng-if="b.icon" class="{{b.icon}}"></i>&nbsp;{{b.title}}</button></div></div><table style="border:1px solid #ddd;margin-bottom:0" class="table table-condensed table-hover"><thead><tr><th ng-show="options.checkbox" width="30px"><input type="checkbox" ng-click="checkboxHandler()" ng-model="allChecked"></th><th ng-repeat="f in fields" style="cursor:pointer;" ng-click="sort(f)" width="{{f.width}}">{{f.title}} &nbsp;<span ng-if="f.sort"><span ng-if="sortKey != f.key" class="text-muted"><i class="fa fa-sort"></i></span><span ng-if="sortKey == f.key &amp;&amp; sortType == \'asc\'"><i class="fa fa-sort-asc text-primary"></i></span><span ng-if="sortKey == f.key &amp;&amp; sortType == \'desc\'"><i class="fa fa-sort-desc text-primary"></i></span></span></th><th ng-if="options.buttons"></th></tr></thead><tbody><tr ng-repeat="r in theRows"><td ng-if="options.checkbox"><input type="checkbox" ng-click="checkboxHandler(r)" ng-model="r.checked"></td><td ng-repeat="f in fields" ng-bind-html="f.valueHandler &amp;&amp; f.valueHandler(valueOfKey(r, f.key)) || valueOfKey(r, f.key)"></td><td ng-if="options.buttons &amp;&amp; options.buttons.length" style="text-align:right"><a href="javascript:;" ng-repeat="btn in options.buttons" ng-if="btn.isShow ? btn.isShow(r) : true" ng-disabled="btn.isDisabled ? btn.isDisabled(r) : false" ng-attr-class="{{btn.className}}" ng-click="btn.action(r)" style="margin-left:5px"><i ng-if="btn.icon" ng-attr-class="{{btn.icon}}" style="margin-right:2px"></i>{{btn.title}}</a></td></tr><tr ng-show="!theRows || theRows.length === 0"><td ng-attr-colspan="{{options.colspan}}"><div style="padding:10px;" ng-show="!options.isLoading" class="text-muted"><i class="fa fa-info-circle"></i>&nbsp;no data</div><div style="padding:10px" ng-show="options.isLoading"><span><i class="fa fa-spin fa-spinner"></i>&nbsp; loading...</span></div></td></tr></tbody><tfoot><tr ng-show="options.pagination.current"><td ng-show="options.checkbox" style="vertical-align:middle"><input type="checkbox" ng-click="checkboxHandler()" ng-model="allChecked"></td><td ng-attr-colspan="{{options.checkbox ? options.colspan - 1 : options.colspan}}"><pagination ng-show="options.pagination.current" style="margin-top:5px;margin-bottom:5px;" total-items="options.pagination.totalItems" items-per-page="options.pagination.itemsPerPage" ng-model="options.pagination.current" max-size="options.pagination.maxSize" boundary-links="options.pagination.boundaryLinks" rotate="options.pagination.rotate" previous-text="{{options.pagination.previousText}}" next-text="{{options.pagination.nextText}}" first-text="{{options.pagination.firstText}}" last-text="{{options.pagination.lastText}}" num-pages="options.pagination.numPages" ng-change="options.pagination.action(options.pagination.current)" class="pull-right pagination-sm"></pagination><div style="margin:10px 10px 5px 0;line-height:1.4" class="pull-right text-muted text-right">共 {{options.pagination.totalItems}} 条 / 每页:<select ng-model="options.pagination.itemsPerPage" ng-change="init()" ng-options="item.value as item.title for item in options.pagination.perPageOptions"></select></div></td></tr></tfoot></table></div>'),t.put("app/controller/mts/index.html",'<div admin-sider-nav="" list="siderNavList" class="kai-left-container"></div><div ui-view="" class="kai-right-container"></div>'),t.put("app/controller/user/index.html",'<div admin-sider-nav="" list="siderNavList" class="kai-left-container"></div><div ui-view="" class="kai-right-container"></div>'),t.put("app/controller/mts/jobHistory/list.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px"><div kai-table="" fields="fields" rows="rows" options="options"></div></div>'),t.put("app/controller/mts/template/form.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px;"><a ui-sref="mts.list"><i class="fa fa-arrow-circle-left"></i>&nbsp;返回列表</a><h1>{{baseInfo.title}}</h1><hr><div ng-if="!loaded"><span class="fa fa-spin fa-spinner"></span>&nbsp;加载中...</div><form ng-if="loaded" style="padding-bottom:100px" ng-submit="submitHandler()" class="kai-form col-md-7"><h2>转码文件设置</h2><div class="form-group"><label><b class="text-danger">*&nbsp;</b><b>转码模板名称</b></label> <input type="text" ng-required="true" ng-minlength="1" ng-maxlength="64" ng-pattern="/^[一-龥_a-zA-Z0-9-%.]{0,}$/" ng-model="template.name" class="form-control"><span class="help-block">1.只能包含中英文、数字、_-.%<br>2.转码模板名称长度限制在128个字节之内</span></div><div class="form-group"><label><b class="text-danger">*&nbsp;</b><b>文件格式</b></label><select ng-model="template.container.format" ng-required="true" class="form-control"><option ng-repeat="type in formBasic.fileType" value="{{type}}">{{type}}</option></select></div><hr><h2>视频设置</h2><div class="form-group"><label><b>编码格式</b></label><select ng-model="template.video.codec" class="form-control"><option ng-repeat="codec in formBasic.videoCodec(template.container.format)" value="{{codec}}">{{codec}}</option></select></div><div ng-if="template.video.codec === \'H.264\'" class="form-group"><label><b>编码级别</b></label><select ng-model="template.video.profile" class="form-control"><option ng-repeat="p in formBasic.videoProfile" value="{{p}}">{{p}}</option></select></div><div class="form-group"><label><b>码率(Kbps)</b></label> <input type="text" text-range="" text-min="10" text-max="50000" ng-model="template.video.bitrate" class="form-control"><span class="help-block">值范围[10, 50000]</span></div><div class="form-group"><label><b>质量控制因子</b></label> <input type="text" text-range="" text-min="0" text-max="51" ng-model="template.video.crf" class="form-control"><span class="help-block">值范围[0,51], 默认值26<br>如果设置了Crf。则Bitrate的设置失效</span></div><div class="form-group"><label><b>视频宽度(px)</b></label> <input type="text" text-range="" text-min="128" text-max="4096" ng-model="template.video.width" class="form-control"><span class="help-block">默认值是视频原始宽度，值范围[128,4096]</span></div><div class="form-group"><label><b>视频高度(px)</b></label> <input type="text" text-range="" text-min="128" text-max="4096" ng-model="template.video.height" class="form-control"><span class="help-block">默认值是视频原始高度，值范围[128,4096]</span></div><div class="form-group"><label><b>帧率(fps)</b></label> <input type="text" text-range="" text-min="0" text-max="60" ng-model="template.video.fps" class="form-control"><span class="help-block">默认值取输入文件帧率，当输入文件帧率超过60时取60, 值范围(0,60]</span></div><div class="form-group"><label><b>关键帧间最大帧数</b></label> <input type="text" text-range="" text-min="1" text-max="100000" ng-model="template.video.gop" class="form-control"><span class="help-block">值范围[1,100000]，默认值250</span></div><div ng-if="template.video.codec === \'H.264\'" class="form-group"><label><b>视频算法器预置</b></label><select ng-model="template.video.preset" class="form-control"><option ng-repeat="op in formBasic.videoPreset" value="{{op}}">{{op}}</option></select></div><div class="form-group"><label><b>扫描模式</b></label><select ng-model="template.video.scanMode" class="form-control"><option ng-repeat="op in formBasic.videoScanMode" value="{{op}}">{{op}}</option></select></div><div class="form-group"><label><b>缓冲区大小(Kb)</b></label> <input type="text" text-range="" text-min="1000" text-max="128000" ng-model="template.video.bufsize" class="form-control"><span class="help-block">值范围[1000,128000]，默认值6000</span></div><div class="form-group"><label><b>码率峰值(Kbps)</b></label> <input type="text" text-range="" text-min="10" text-max="50000" ng-model="template.video.maxrate" class="form-control"><span class="help-block">值范围[10,50000]</span></div><div ng-if="template.video.codec === \'H.264\'" class="form-group"><label><b>视频码率范围 - 上限 (Kbps)</b></label> <input type="text" text-range="" text-min="10" text-max="50000" ng-model="template.video.bitrateBnd.max" class="form-control"><span class="help-block">[10, 50000]</span></div><div ng-if="template.video.codec === \'H.264\'" class="form-group"><label><b>视频码率范围 - 下限 (Kbps)</b></label> <input type="text" text-range="" text-min="10" text-max="50000" ng-model="template.video.bitrateBnd.min" class="form-control"><span class="help-block">[10, 50000]</span></div><div class="form-group"><label><b>视频颜色格式</b></label> <input type="text" ng-model="template.video.pixFmt" class="form-control"></div><hr><h2>音频设置</h2><div class="form-group"><label><b>编码格式</b></label><select ng-model="template.audio.codec" class="form-control"><option ng-repeat="op in formBasic.audioCodec" value="{{op}}">{{op}}</option></select></div><div ng-if="template.audio.codec === \'AAC\'" class="form-group"><label><b>音频编码预置</b></label><select ng-model="template.audio.profile" class="form-control"><option ng-repeat="op in formBasic.audioProfile" value="{{op}}">{{op}}</option></select></div><div class="form-group"><label><b>采样率(Hz)</b></label><select ng-model="template.audio.samplerate" class="form-control"><option ng-repeat="op in formBasic.audioSamplerate(template.container.format, template.audio.codec)" value="{{op}}">{{op}}</option></select></div><div class="form-group"><label><b>输出码率(Kbps)</b></label> <input type="text" text-range="" text-min="8" text-max="1000" ng-model="template.audio.bitrate" class="form-control"><span class="help-block">值范围[8,1000]</span></div><div class="form-group"><label><b>声道数</b></label><select ng-model="template.audio.channels" class="form-control"><option ng-repeat="op in formBasic.audioChannels(template.audio.codec)" value="{{op}}">{{op}}</option></select></div><hr><h2>封包参数</h2><div class="form-group"><label><b>分片时长(s)</b></label> <input type="text" ng-model="template.muxConfig.segment.duration" class="form-control"></div><button type="submit" class="btn btn-lg btn-primary">确定</button></form></div>'),t.put("app/controller/mts/template/list.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px"><div kai-table="" fields="fields" rows="rows" options="options"></div></div>'),t.put("app/controller/mts/jobTemplate/form.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px;"><a ui-sref="mts.jobTemplateList"><i class="fa fa-arrow-circle-left"></i>&nbsp;返回列表</a><h1>{{baseInfo.title}}</h1><hr><div ng-if="!loaded"><span class="fa fa-spin fa-spinner"></span>&nbsp;加载中...</div><form ng-if="loaded" style="padding-bottom:100px" ng-submit="submitHandler()" class="kai-form col-md-7"><div class="form-group"><label><b class="text-danger">*&nbsp;</b><b>名称</b></label> <input type="text" ng-required="true" ng-minlength="1" ng-maxlength="64" ng-pattern="/^[一-龥_a-zA-Z0-9-%.]{0,}$/" ng-model="template.name" class="form-control"><span class="help-block">1.只能包含中英文、数字、_-.%<br>2.转码模板名称长度限制在128个字节之内</span></div><div class="form-group"><label><b>描述</b></label> <textarea ng-model="template.desc" class="form-control"></textarea></div><div class="form-group"><label><b>Outputs</b></label><div id="jsoneditor" ng-init="initJSONEditor()" style="height: 400px;"></div><span class="help-block">转码作业输出的配置,以JSON格式编辑</span></div><div class="form-group"><label><b>转码管道ID</b></label><select ng-required="true" ng-model="template.pipelineId" class="form-control"><option ng-repeat="pl in pipelines" value="{{pl.id}}">{{pl.name}}</option></select></div><div class="form-group"><label><b>输出Bucket</b></label> <input type="text" ng-required="true" ng-model="template.outputBucket" class="form-control"></div><div class="form-group"><label><b>输出Location</b></label> <input type="text" ng-required="true" ng-model="template.outputLocation" class="form-control"></div><div class="form-group"><label><b>默认应用</b></label><select ng-model="template.using" ng-options="o.v as o.n for o in [{ n: \'否\', v: false }, { n: \'是\', v: true }]" class="form-control"></select></div><div class="form-group"><label><b>最后操作人</b></label> <input type="text" disabled="disabled" ng-model="template.adminId" class="form-control"></div><div class="form-group"><label><b>最后更新时间</b></label><p>{{template.lastUpdate * 1000|date:\'yyyy-MM-dd HH:mm:ss\'}}</p></div><button type="submit" class="btn btn-lg btn-success"><i class="fa fa-check"></i>&nbsp;确定</button></form></div>'),t.put("app/controller/mts/jobTemplate/list.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px"><div kai-table="" fields="fields" rows="rows" options="options"></div></div>'),t.put("app/controller/mts/video/form.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px; width: 440px" class="video-edit-form"><a ui-sref="mts.videoList"><i class="fa fa-arrow-circle-left"></i>&nbsp;返回列表</a><h1>{{baseInfo.title}}</h1><hr><form><input type="hidden" ng-model="vid" name="id"> <label>视频</label> <input type="file" name="mediaFile" class="mediaInput form-control"><div kai-player="" source="data.mediaURL" ng-if="!isNew"></div><label>缩略图</label> <input type="file" name="picFile" class="picInput form-control"><div ng-if="!isNew"><img src="{{data.picURL}}" width="400" height="300"></div><label>Title</label> <input type="text" name="title" ng-model="data.baseInfo.title" class="form-control"> <label>描述</label><div><textarea ng-model="data.baseInfo.description" style="height:100px;" name="desc" class="form-control"></textarea></div><label>状态 {{data.baseInfo.status}}</label><select ng-model="data.baseInfo.status" ng-options="op.value as op.title for op in statusList" name="status" class="form-control"></select><label>是否转码</label><select ng-model="data.isTranscode" class="form-control"><option value="false">否</option><option value="true">是</option></select><button type="submit" style="margin-top:20px" ng-click="save($event)" class="btn btn-lg btn-primary">保存</button></form></div>'),t.put("app/controller/mts/video/list.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px"><div kai-ajax-table="" fields="fields" rows="rows" options="options"></div></div>'),t.put("app/controller/mts/watermark/form.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px;"><a ui-sref="mts.wmList"><i class="fa fa-arrow-circle-left"></i>&nbsp;返回列表</a><h1>{{baseInfo.title}}</h1><hr><div ng-if="!loaded"><span class="fa fa-spin fa-spinner"></span>&nbsp;加载中...</div><form ng-if="loaded" style="padding-bottom:100px" ng-submit="submitHandler()" class="kai-form col-md-7"><h2>转码文件设置</h2><div class="form-group"><label><b class="text-danger">*&nbsp;</b><b>水印模板名称</b></label> <input type="text" ng-required="true" ng-minlength="1" ng-maxlength="64" ng-pattern="/^[一-龥_a-zA-Z0-9-%.]{0,}$/" ng-model="template.name" class="form-control"><span class="help-block">1.只能包含中英文、数字、_-.%<br>2.转码模板名称长度限制在128个字节之内</span></div><div class="form-group"><label><b class="text-danger">*&nbsp;</b><b>水印位置</b></label><select ng-model="template.config.referPos" ng-required="true" class="form-control"><option ng-repeat="op in formBasic.referPos" value="{{op}}">{{op}}</option></select></div><div class="form-group"><label><b>水印宽度(px)</b></label> <input type="text" text-range="" text-min="8" text-max="4096" ng-model="template.config.width" class="form-control"><span class="help-block">值范围[8,4096]</span></div><div class="form-group"><label><b>水印高度(px)</b></label> <input type="text" text-range="" text-min="8" text-max="4096" ng-model="template.config.height" class="form-control"><span class="help-block">值范围[8,4096]</span></div><div class="form-group"><label><b>水平偏移量(px)</b></label> <input type="text" text-range="" text-min="-4096" text-max="4096" ng-model="template.config.dx" class="form-control"><span class="help-block">值范围[-4096,4096]</span></div><div class="form-group"><label><b>垂直偏移量(px)</b></label> <input type="text" text-range="" text-min="-4096" text-max="4096" ng-model="template.config.dy" class="form-control"><span class="help-block">值范围[-4096,4096]</span></div><button type="submit" class="btn btn-lg btn-success"><i class="fa fa-check"></i>&nbsp;确定</button></form></div>'),t.put("app/controller/mts/watermark/list.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px"><div kai-table="" fields="fields" rows="rows" options="options"></div></div>'),t.put("app/controller/user/form/form.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px;"><a ui-sref="user.list"><i class="fa fa-arrow-circle-left"></i>&nbsp;返回列表</a><h1>{{baseInfo.title}}</h1><hr><div ng-if="!loaded"><span class="fa fa-spin fa-spinner"></span>&nbsp;加载中...</div><form ng-if="loaded" style="padding-bottom:100px" ng-submit="submitHandler()" class="kai-form col-md-7"><h2>转码文件设置</h2><div class="form-group"><label><b class="text-danger">*&nbsp;</b><b>用户名</b></label> <input type="text" ng-disabled="true" ng-model="template.username" class="form-control"></div><div class="form-group"><label><b>用户权限</b></label><div class="checkbox"><label><input type="checkbox" ng-model="template.auth.ROLE_ADMIN">ADMIN</label></div><div class="checkbox"><label><input type="checkbox" ng-model="template.auth.ROLE_USER">USER</label></div></div><div class="form-group"><label><b>状态</b></label><div class="radio"><label><input type="radio" ng-model="template.enabled" ng-value="true">正常</label></div><div class="radio"><label><input type="radio" ng-model="template.enabled" ng-value="false">禁用</label></div></div><button type="submit" class="btn btn-lg btn-success"><i class="fa fa-check"></i>&nbsp;确定</button></form></div>'),t.put("app/controller/user/list/list.html",'<div ng-init="init()" style="padding:10px 20px;margin-top:20px"><div kai-table="" fields="fields" rows="rows" options="options"></div></div>')
}]);